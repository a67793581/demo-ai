# AI åŠ¨ç”»ç”Ÿæˆå¹³å°

ä¸€ä¸ªåŸºäº FastAPI + Celery + Redis + MongoDB çš„ AI é©±åŠ¨åŠ¨ç”»ç”Ÿæˆå¹³å°ï¼Œæ”¯æŒæ–‡å­—å’Œå›¾ç‰‡è¾“å…¥ï¼Œé€šè¿‡ OCR è¯†åˆ«ã€Prompt ç”Ÿæˆå’Œç¬¬ä¸‰æ–¹è§†é¢‘å¹³å° API ç”Ÿæˆæ•™å­¦åŠ¨ç”»ã€‚

## ğŸš€ é¡¹ç›®ç‰¹æ€§

- **å¼‚æ­¥ä»»åŠ¡å¤„ç†**: åŸºäº Celery + Redis çš„é˜Ÿåˆ—ç³»ç»Ÿï¼Œæ”¯æŒé«˜å¹¶å‘ä»»åŠ¡å¤„ç†
- **å¤šè¾“å…¥æ”¯æŒ**: æ”¯æŒæ–‡å­—å’Œå›¾ç‰‡è¾“å…¥ï¼Œè‡ªåŠ¨ OCR è¯†åˆ«
- **æ¨¡å—åŒ–æ¶æ„**: æ¸…æ™°çš„ä¸šåŠ¡é€»è¾‘ä¸å­˜å‚¨å±‚åˆ†ç¦»
- **å®¹å™¨åŒ–éƒ¨ç½²**: å®Œæ•´çš„ Docker æ”¯æŒï¼Œä¸€é”®éƒ¨ç½²
- **å¥åº·æ£€æŸ¥**: å†…ç½®æœåŠ¡å¥åº·ç›‘æ§å’Œè‡ªåŠ¨æ•…éšœæ£€æµ‹
- **MongoDB è®¤è¯**: å®‰å…¨çš„æ•°æ®åº“è¿æ¥å’Œè®¤è¯æœºåˆ¶
- **å®æ—¶ç›‘æ§**: æä¾›å®æ—¶æœåŠ¡çŠ¶æ€ç›‘æ§è„šæœ¬

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢      â”‚    â”‚   FastAPI       â”‚    â”‚   Celery        â”‚
â”‚   (Web UI)      â”‚â—„â”€â”€â–ºâ”‚   (API Server)  â”‚â—„â”€â”€â–ºâ”‚   (Worker)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚     Redis       â”‚    â”‚    MongoDB      â”‚
                       â”‚   (Message      â”‚    â”‚   (Task Storage)â”‚
                       â”‚    Queue)       â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI (Python 3.13)
- **ä»»åŠ¡é˜Ÿåˆ—**: Celery + Redis
- **æ•°æ®åº“**: MongoDB 7.0 (å¸¦è®¤è¯)
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ä¾èµ–ç®¡ç†**: Poetry
- **å¥åº·æ£€æŸ¥**: Docker Health Checks

## ğŸ“ é¡¹ç›®ç»“æ„

```
demo-ai/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ ai_animation/
â”‚   â”‚   â”œâ”€â”€ api/                 # API å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py        # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ routes.py        # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ config/              # é…ç½®å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ api.py           # API é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ app.py           # åº”ç”¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç¡€é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ db.py            # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ error.py         # é”™è¯¯é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ redis.py         # Redis é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ task.py          # ä»»åŠ¡é…ç½®
â”‚   â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ tasks.py         # Celery ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ storage/             # å­˜å‚¨å±‚ (ç‹¬ç«‹æ¨¡å—)
â”‚   â”‚   â”‚   â””â”€â”€ storage.py       # MongoDB å­˜å‚¨å®ç°
â”‚   â”‚   â””â”€â”€ utils/               # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ demo_ai/
â”‚       â”œâ”€â”€ celery_app.py        # Celery åº”ç”¨é…ç½®
â”‚       â”œâ”€â”€ main.py              # FastAPI ä¸»åº”ç”¨
â”‚       â”œâ”€â”€ static/              # é™æ€æ–‡ä»¶
â”‚       â””â”€â”€ templates/           # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml           # Docker Compose é…ç½®
â”œâ”€â”€ Dockerfile                   # åº”ç”¨é•œåƒæ„å»º
â”œâ”€â”€ Dockerfile.deps              # ä¾èµ–é•œåƒæ„å»º
â”œâ”€â”€ pyproject.toml               # Poetry é…ç½®
â”œâ”€â”€ start.sh                     # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop.sh                      # åœæ­¢è„šæœ¬
â”œâ”€â”€ build.sh                     # æ„å»ºè„šæœ¬
â”œâ”€â”€ local_health_check.sh        # æœ¬åœ°å¥åº·æ£€æŸ¥
â”œâ”€â”€ monitor.sh                   # å®æ—¶ç›‘æ§è„šæœ¬
â””â”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Docker & Docker Compose
- Python 3.13+ (æœ¬åœ°å¼€å‘)
- Poetry (æœ¬åœ°å¼€å‘)

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/a67793581/demo-ai.git
cd demo-ai
```

### 2. æ„å»ºé•œåƒ

```bash
./build.sh
```

### 3. å¯åŠ¨æœåŠ¡

```bash
./start.sh
```

å¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰ Docker å®¹å™¨
- ç­‰å¾…æ‰€æœ‰æœåŠ¡é€šè¿‡å¥åº·æ£€æŸ¥
- æ˜¾ç¤ºæœåŠ¡çŠ¶æ€å’Œè®¿é—®åœ°å€

### 4. è®¿é—®æœåŠ¡

- **Web ç•Œé¢**: http://localhost:8000
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### æœ¬åœ°å¼€å‘è®¾ç½®

1. **å®‰è£…ä¾èµ–**
```bash
poetry install
```

2. **å¯åŠ¨ä¾èµ–æœåŠ¡**
```bash
docker-compose up -d redis mongodb
```

3. **å¯åŠ¨åº”ç”¨æœåŠ¡**
```bash
# å¯åŠ¨ FastAPI æœåŠ¡
PYTHONPATH=src poetry run uvicorn demo_ai.main:app --host 0.0.0.0 --port 8000 --reload

# å¯åŠ¨ Celery Worker (æ–°ç»ˆç«¯)
PYTHONPATH=src poetry run celery -A demo_ai.celery_app worker --loglevel=info
```

## ğŸ“Š æœåŠ¡ç›‘æ§

### å¥åº·æ£€æŸ¥

```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥
./local_health_check.sh

# å®æ—¶ç›‘æ§
./monitor.sh
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f [service_name]
```

## ğŸ”Œ API æ¥å£

### æäº¤ä»»åŠ¡

```bash
curl -X POST "http://localhost:8000/ai-animation/submit-task" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "input_type": "text",
    "input_content": "ç”Ÿæˆä¸€ä¸ªå…³äºå¤ªé˜³ç³»çš„åŠ¨ç”»"
  }'
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€

```bash
curl -X POST "http://localhost:8000/ai-animation/query-status" \
  -H "Content-Type: application/json" \
  -d '{
    "task_id": "user123_abc12345"
  }'
```

### è·å–ä»»åŠ¡åˆ—è¡¨

```bash
curl -X POST "http://localhost:8000/ai-animation/list-tasks" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user123",
    "page": 1,
    "page_size": 10
  }'
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `DOCKER_ENV` | `false` | æ˜¯å¦åœ¨ Docker ç¯å¢ƒä¸­è¿è¡Œ |
| `MONGO_USERNAME` | `admin` | MongoDB ç”¨æˆ·å |
| `MONGO_PASSWORD` | `password` | MongoDB å¯†ç  |

### æœåŠ¡é…ç½®

- **Redis**: ç«¯å£ 6379ï¼Œæ— è®¤è¯
- **MongoDB**: ç«¯å£ 27017ï¼Œç”¨æˆ·å/å¯†ç è®¤è¯
- **Web æœåŠ¡**: ç«¯å£ 8000
- **Celery Worker**: è‡ªåŠ¨è¿æ¥åˆ° Redis

## ğŸ”’ å®‰å…¨è¯´æ˜

- MongoDB ä½¿ç”¨ç”¨æˆ·å/å¯†ç è®¤è¯
- æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½æœ‰å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- æœåŠ¡é—´é€šä¿¡ä½¿ç”¨å†…éƒ¨ç½‘ç»œ
- å¥åº·æ£€æŸ¥ç¡®ä¿æœåŠ¡å¯ç”¨æ€§

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MongoDB è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥ MongoDB å®¹å™¨çŠ¶æ€
   docker-compose ps mongodb
   
   # æŸ¥çœ‹ MongoDB æ—¥å¿—
   docker-compose logs mongodb
   ```

2. **Celery Worker æ— æ³•å¯åŠ¨**
   ```bash
   # æ£€æŸ¥ Redis è¿æ¥
   docker-compose exec redis redis-cli ping
   
   # æŸ¥çœ‹ Worker æ—¥å¿—
   docker-compose logs worker
   ```

3. **æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥**
   ```bash
   # è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬
   ./local_health_check.sh
   ```

### é‡å¯æœåŠ¡

```bash
# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart [service_name]

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose down
docker-compose up -d
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- æ‰€æœ‰ä»»åŠ¡å¤„ç†æ—¶é—´ç»Ÿä¸€è®¾ç½®ä¸º 3 ç§’ï¼ˆä¾¿äºæµ‹è¯•ï¼‰
- MongoDB å·²åˆ›å»º task_id å’Œ user_id ç´¢å¼•
- Redis è¿æ¥æ± ä¼˜åŒ–
- Celery Worker å¹¶å‘æ•°å¯é…ç½®

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

- é¡¹ç›®ç»´æŠ¤è€…: Carlo (jiangbingjie1218@gmail.com)
- é¡¹ç›®é“¾æ¥: [https://github.com/a67793581/demo-ai.git](https://github.com/a67793581/demo-ai.git)

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®å’Œå®‰å…¨è®¾ç½®ã€‚